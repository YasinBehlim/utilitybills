<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Utility Bill Calculator – Pakistan 2025</title>
  <style>
    body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);color:#333;margin:0;padding:20px;min-height:100vh}
    .container{max-width:800px;margin:30px auto;background:#fff;border-radius:20px;box-shadow:0 15px 40px rgba(0,0,0,0.2);overflow:hidden}
    .header{background:#2c3e50;color:#fff;padding:30px;text-align:center}
    h1{margin:0;font-size:2.4rem}
    .subtitle{font-size:1.1rem;opacity:0.9;margin-top:8px}
    .card{padding:35px}
    select,input{width:100%;padding:16px;margin:12px 0;border:2px solid #ddd;border-radius:12px;font-size:1.1rem;box-sizing:border-box}
    select:focus,input:focus{border-color:#667eea;outline:none}
    button{background:#e74c3c;color:#fff;padding:18px 40px;border:none;border-radius:12px;cursor:pointer;font-size:1.3rem;font-weight:bold;margin-top:20px;width:100%}
    button:hover{background:#c0392b}
    .result{margin-top:40px;background:#f8f9fa;padding:30px;border-radius:16px;display:none}
    table{width:100%;border-collapse:collapse;margin:20px 0}
    th,td{padding:14px;text-align:left;border-bottom:1px solid #ddd}
    th{background:#667eea;color:#fff}
    .total{font-size:1.8rem;font-weight:bold;color:#e74c3c;padding:20px;background:#fff3cd;border-radius:12px;text-align:center;margin:20px 0}
    .note{font-size:0.95rem;color:#e74c3c;margin-top:20px;text-align:center}
    footer{padding:20px;background:#2c3e50;color:#fff;text-align:center;font-size:0.9rem}
    .hidden{display:none}
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Utility Bill Calculator</h1>
    <p class="subtitle">Electricity + Gas + Water • All Pakistan • 2025 Latest Tariffs</p>
  </div>

  <div class="card">
    <form id="billForm">
      <select id="utility" required onchange="updateCompanies()">
        <option value="">Select Utility</option>
        <option value="electricity">Electricity</option>
        <option value="gas">Gas (Sui)</option>
        <option value="water">Water</option>
      </select>

      <select id="company" required onchange="updateTariffOptions()">
        <option value="">Select Company First</option>
      </select>

      <select id="connection" required>
        <option value="">Connection Type</option>
        <option value="domestic">Domestic / Residential</option>
        <option value="commercial">Commercial</option>
      </select>

      <select id="tariff" required>
        <option value="">Tariff Type</option>
      </select>

      <div id="normalUnits">
        <input type="number" id="units" placeholder="Enter Units Consumed (kWh / MCF / KL)" min="1" required>
      </div>

      <div id="touUnits" class="hidden">
        <input type="number" id="peak" placeholder="Peak Units (6pm–10pm)" min="0">
        <input type="number" id="offpeak" placeholder="Off-Peak Units" min="0">
      </div>

      <button type="submit">Calculate Bill</button>
    </form>
  </div>

  <div id="result" class="result">
    <h2>Your Bill Breakdown</h2>
    <table>
      <tr><th>Description</th><th>Amount (Rs.)</th></tr>
      <tbody id="breakdown"></tbody>
    </table>
    <div class="total" id="finalAmount"></div>
    <button onclick="window.print()" style="background:#27ae60;margin-top:20px">Print / Save as PDF</button>
    <p class="note">Estimated bill • Actual bill may vary slightly due to adjustments</p>
  </div>

  <footer>Pakistan Utility Portal © 2025</footer>
</div>

<script>
// Fixed & Working 2025 Tariffs
const tariffs = {
  electricity: {
    companies: ["K-Electric","LESCO","IESCO","FESCO","MEPCO","GEPCO","PESCO","HESCO","QESCO","SEPCO","TESCO"],
    domestic_normal: [[0,100,23.17],[100,200,28.07],[200,300,33.14],[300,Infinity,41.97]],
    domestic_protected: [[0,50,6.05],[50,100,11.10],[100,200,14.16],[200,Infinity,41.97]],
    tou_peak: 44.57, tou_offpeak: 34.57,
    commercial: 43.07
  },
  gas: {
    companies: ["SNGPL (Punjab/KPK)","SSGC (Sindh/Balochistan)"],
    domestic: 5457,  // per MCF (approx average 2025)
    commercial: 8500
  },
  water: {
    companies: ["WASA Lahore","WASA Faisalabad","KWSB Karachi","QWASA Quetta"],
    domestic: 12,   // average Rs/KL
    commercial: 30
  }
};

function updateCompanies() {
  const utility = document.getElementById("utility").value;
  const companySelect = document.getElementById("company");
  companySelect.innerHTML = "<option value=''>Select Company</option>";
  
  if (!utility) return;
  
  const list = utility === "electricity" ? tariffs.electricity.companies :
               utility === "gas" ? tariffs.gas.companies : tariffs.water.companies;
  
  list.forEach(c => {
    companySelect.innerHTML += `<option value="${c}">${c}</option>`;
  });
  
  updateTariffOptions();
}

function updateTariffOptions() {
  const utility = document.getElementById("utility").value;
  const tariffSelect = document.getElementById("tariff");
  tariffSelect.innerHTML = "<option value=''>Select Tariff</option>";
  
  if (utility === "electricity") {
    tariffSelect.innerHTML += `<option value="normal">Normal</option>
                               <option value="protected">Protected (≤200 units)</option>
                               <option value="tou">Time of Use (ToU Meter)</option>`;
  } else {
    tariffSelect.innerHTML += `<option value="normal">Standard</option>`;
  }
  
  document.getElementById("touUnits").classList.add("hidden");
  document.getElementById("normalUnits").style.display = "block";
}

document.getElementById("tariff").addEventListener("change", () => {
  const isToU = document.getElementById("tariff").value === "tou";
  document.getElementById("touUnits").classList.toggle("hidden", !isToU);
  document.getElementById("normalUnits").style.display = isToU ? "none" : "block";
});

document.getElementById("billForm").onsubmit = function(e) {
  e.preventDefault();
  const utility = document.getElementById("utility").value;
  const connection = document.getElementById("connection").value;
  const tariff = document.getElementById("tariff").value;
  
  let units = 0, peak = 0, offpeak = 0;
  if (tariff === "tou") {
    peak = +document.getElementById("peak").value || 0;
    offpeak = +document.getElementById("offpeak").value || 0;
    units = peak + offpeak;
  } else {
    units = +document.getElementById("units").value || 0;
  }
  
  if (units <= 0) return alert("Please enter units");
  
  let energy = 0;
  if (utility === "electricity") {
    if (tariff === "tou") {
      energy = peak * tariffs.electricity.tou_peak + offpeak * tariffs.electricity.tou_offpeak;
    } else if (connection === "commercial") {
      energy = units * tariffs.electricity.commercial;
    } else {
      const slab = tariff === "protected" ? tariffs.electricity.domestic_protected : tariffs.electricity.domestic_normal;
      let rem = units;
      for (let s of slab) {
        if (rem <= 0) break;
        const take = Math.min(rem, s[1] - s[0]);
        energy += take * s[2];
        rem -= take;
      }
    }
  } else if (utility === "gas") {
    energy = units * (connection === "commercial" ? tariffs.gas.commercial : tariffs.gas.domestic);
  } else if (utility === "water") {
    energy = units * (connection === "commercial" ? tariffs.water.commercial : tariffs.water.domestic);
  }
  
  const gst = energy * 0.17;
  const total = Math.ceil(energy + gst + (utility === "electricity" ? units * 0.43 + 35 : 0));
  
  const rows = [
    ["Energy Charges", energy.toFixed(0)],
    ["GST 17%", gst.toFixed(0)],
    utility === "electricity" ? ["FC Surcharge + TV Fee", (units * 0.43 + 35).toFixed(0)] : null,
    ["<strong>Total Payable</strong>", "<strong>Rs. " + total.toLocaleString() + "</strong>"]
  ].filter(Boolean);
  
  let html = "";
  rows.forEach(r => html += `<tr><td>${r[0]}</td><td style="text-align:right">${r[1]}</td></tr>`);
  
  document.getElementById("breakdown").innerHTML = html;
  document.getElementById("finalAmount").innerHTML = "Your Estimated Bill: <strong>Rs. " + total.toLocaleString() + "</strong>";
  document.getElementById("result").style.display = "block";
  document.getElementById("result").scrollIntoView({behavior: "smooth"});
};
</script>
</body>
</html>
