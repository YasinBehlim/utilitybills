<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fetch Water Bill - Pakistan 2025</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);color:#333;margin:0;padding:20px;min-height:100vh}
    .container{max-width:700px;margin:40px auto;background:#fff;border-radius:20px;box-shadow:0 15px 40px rgba(0,0,0,0.3);overflow:hidden}
    .header{background:#e74c3c;color:#fff;padding:30px;text-align:center}
    h1{margin:0;font-size:2.5rem}
    .card{padding:40px;text-align:center}
    select,input{width:100%;padding:18px;margin:15px 0;border:2px solid #ddd;border-radius:12px;font-size:1.2rem}
    button{background:#27ae60;color:#fff;padding:18px;border:none;border-radius:12px;cursor:pointer;font-size:1.4rem;width:100%;margin-top:20px}
    button:hover{background:#1e8449}
    .bill-container{display:none;background:#fff;padding:40px;border:2px solid #ddd;border-radius:15px;margin:30px 0;box-shadow:0 8px 25px rgba(0,0,0,0.15)}
    .bill-header{background:#e74c3c;color:#fff;padding:20px;border-radius:10px 10px 0 0;text-align:center}
    .bill-body{padding:25px;font-size:1.1rem;line-height:1.8}
    table{width:100%;border-collapse:collapse;margin:20px 0}
    td{padding:12px;border-bottom:1px solid #eee}
    .status{padding:8px 20px;border-radius:50px;font-weight:bold;color:#fff;margin:15px 0;display:inline-block}
    .paid{background:#27ae60}
    .unpaid{background:#e74c3c}
    footer{padding:20px;background:#2c3e50;color:#fff;text-align:center}
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Fetch Water Bill</h1>
    <p>All Water Companies • Enter your Account Number</p>
  </div>
  <div class="card">
    <select id="company" required>
      <option value="">Select Water Company</option>
      <option value="lahore">Lahore</option>
      <option value="islamabad">Islamabad</option>
      <option value="karachi">Karachi</option>
    </select>
    <input type="text" id="ref" placeholder="Enter Account Number (10-14 digits)" maxlength="14">
    <select id="month">
      <option value="">Select Bill Month</option>
      <option>January 2025</option><option>February 2025</option><option>March 2025</option>
      <option>April 2025</option><option>May 2025</option><option>June 2025</option>
      <option>July 2025</option><option>August 2025</option><option>September 2025</option>
      <option>October 2025</option><option selected>November 2025</option><option>December 2025</option>
    </select>
    <button onclick="fetchBill()">Fetch Bill</button>
  </div>

  <div id="billContainer" class="bill-container">
    <div id="bill" class="bill-body">
      <div class="bill-header">
        <h2>WATER BILL</h2>
        <p>Account No: <strong id="refNo"></strong> | Month: <span id="billMonth">November 2025</span></p>
      </div>
      <table>
        <tr><td>Consumer Name</td><td><strong>---</strong></td></tr>
        <tr><td>Address</td><td>---</td></tr>
        <tr><td>Bill Issue Date</td><td>28 Nov 2025</td></tr>
        <tr><td>Due Date</td><td>15 Dec 2025</td></tr>
        <tr><td>Units Consumed</td><td>---</td></tr>
        <tr><td>Bill Amount</td><td><strong style="font-size:1.4rem;color:#e74c3c">Rs. ---</strong></td></tr>
        <tr><td>Status</td><td><span class="status" id="status">---</span></td></tr>
      </table>
      <button onclick="downloadPDF()">Download PDF</button>
      <button onclick="window.print()" style="background:#3498db;margin-left:10px">Print Bill</button>
      <button onclick="shareBill()" style="background:#25d366;margin-left:10px">Share on WhatsApp</button>
    </div>
  </div>
</div>
<footer>Pakistan Utility Portal © 2025</footer>

<script>
async function fetchBill() {
  const company = document.getElementById("company").value;
  const ref = document.getElementById("ref").value.trim();
  const month = document.getElementById("month").value;
  if (!company) return alert("Select Company");
  if (!ref || ref.length < 10 || ref.length > 14 || isNaN(ref)) return alert("Enter valid number (10-14 digits)");
  if (!month) return alert("Select bill month");

  try {
    const res = await fetch("bills.json");
    const data = await res.json();
    const billData = data.water[company]?.[ref];
    if (!billData) return alert("No bill found for this number and company");

    document.getElementById("refNo").textContent = ref;
    document.getElementById("billMonth").textContent = month;
    document.getElementById("billContainer").style.display = "block";
    document.getElementById("billContainer").scrollIntoView({behavior:"smooth"});

    const tableRows = document.querySelector("#bill table").rows;
    tableRows[0].cells[1].innerHTML = `<strong>${billData.name}</strong>`;
    tableRows[1].cells[1].textContent = billData.address;
    tableRows[4].cells[1].textContent = billData.units + " Liters";
    tableRows[5].cells[1].innerHTML = `<strong style="font-size:1.4rem;color:#e74c3c">Rs. ${billData.amount}</strong>`;

    const status = document.getElementById("status");
    const isPaid = Math.random() > 0.5;
    status.textContent = isPaid ? "PAID" : "UNPAID";
    status.className = "status " + (isPaid ? "paid" : "unpaid");

  } catch (err) {
    alert("Error fetching bill. Try again.");
    console.error(err);
  }
}

function downloadPDF() {
  const { jsPDF } = window.jspdf;
  html2canvas(document.getElementById("bill")).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jsPDF("p", "mm", "a4");
    const width = pdf.internal.pageSize.getWidth();
    const height = (canvas.height * width) / canvas.width;
    pdf.addImage(imgData, "PNG", 0, 0, width, height);
    pdf.save("Water_Bill.pdf");
  });
}

function shareBill() {
  const text = `My Water Bill%0AAccount No: ${document.getElementById("refNo").textContent}%0AAmount: ${document.querySelector("#bill table tr:nth-child(6) td strong").textContent}%0AStatus: ${document.getElementById("status").textContent}%0AView yours: ${location.href}`;
  window.open(`https://wa.me/?text=${text}`);
}
</script>
</body>
</html>
